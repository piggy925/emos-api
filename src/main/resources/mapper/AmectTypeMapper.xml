<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mumu.emos.api.db.dao.AmectTypeMapper">
    <select id="searchAllAmectType" resultType="com.mumu.emos.api.db.pojo.AmectType">
        SELECT id,
               type,
               money,
               systemic
        FROM tb_amect_type
    </select>

    <select id="searchAmectTypeByPage" parameterType="HashMap" resultType="HashMap">
        SELECT `at`.id,
        `at`.type,
        `at`.money,
        `at`.systemic,
        COUNT( a.type_id ) AS notPay,
        IF(COUNT(a.id)=0 AND systemic=false ,"true","false") AS canDelete
        FROM tb_amect_type `at`
        LEFT JOIN tb_amect a ON `at`.id = a.type_id AND a.`status` = 1
        WHERE 1=1
        <if test="type != null">
            AND `at`.type LIKE '%${type}%'
        </if>
        GROUP BY `at`.id
        LIMIT #{start}, #{length}
    </select>
    
    <select id="searchAmectTypeCount" parameterType="HashMap" resultType="long">
        SELECT COUNT(temp.ct)
        FROM (
        SELECT COUNT(*) AS ct
        FROM tb_amect_type `at`
        LEFT JOIN tb_amect a ON `at`.id = a.type_id AND a.`status` = 1
        WHERE 1=1
        <if test="type != null">
            AND `at`.type LIKE '%${type}%'
        </if>
        GROUP BY `at`.id
        ) temp
    </select>
</mapper>